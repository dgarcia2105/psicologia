@*@{
    ViewData["Title"] = "Home Page.";
    Layout = "~/Views/Shared/_Layout_Public.cshtml";
}
<h1>
    Log
</h1>

<form method="post">
    <input type="text" name="username" placeholder="Typer Username" />
    <input type="password" name="password" placeholder="Typer Password" />
    <button class="btn btn-primary"></button>
</form>*@

@*README
    https://www.bootdey.com/snippets/tagged/contacts*@
@inject IHttpContextAccessor contxt
@model MM.CAAM.Gestion.DTO.DTOs.UsuarioDTO
@{
    //ViewBag.MetaDescripcion = Model.MetaHtml.Description;
    //ViewBag.MetaAuthor = Model.MetaHtml.Author;
    //ViewBag.MetaKeywords = Model.MetaHtml.Keywords;
    //ViewBag.Descripcion = Model.Descripcion;
    Layout = "~/Views/Shared/_Layout_Public.cshtml";
    ViewBag.Title = "Login";
}
<br />
@*<h1>Agregar usuario</h1>*@
<br />

<div class=" px-1 py-2 mx-auto">
    <div class="d-flex justify-content-center" >
        <div class="col-xl-7 col-lg-8 col-md-9 col-11" >
            <div class="row">
                <div class="col-sm-12 text-center">
                    @*<img src="~/assets/imgages/medico/esculapio.png" width="50px" alt="Alternate Text" style="opacity:0.8" />*@
                </div>
            </div>
            <br />
            <br />
            <div class="">
                <div class="row">
                    <div class="col-sm-12 text-center">
                        <h3 class="" style="color:white;">Iniciar sesión</h3>
                    </div>
                </div>
                <div class="align-items-center text-center">
                    <div class="col-md-12">
                        <div class="card-body">
                            <form method="post" onsubmit="return sendAjax();">
                                @*id="formCustom" method="post"*@
                                @*onsubmit="sendAjax();"*@
                                @*method="post" enctype="multipart/form-data"*@
                                @*<h4 class="mb-3 f-w-400">Iniciar Sesión</h4>*@
                                <div class="input-group mb-3">
                                    <span class="input-group-text"><i data-feather="user"></i></span>
                                    @Html.EditorFor(model => model.Correo, new { htmlAttributes = new { @placeholder = "Tu email", @class = "form-control", @required = "required" } })
                                </div>
                                <div class="input-group mb-4">
                                    <span class="input-group-text"><i data-feather="lock"></i></span>
                                    @Html.EditorFor(model => model.Password, new { htmlAttributes = new { @placeholder = "Tu contraseña", @class = "form-control lock-input", @required = "required", @Type = "password" } })
                                </div>
                                <div class="">
                                    <div class="col-xs-12 input-group">
                                        @*<button type="button" class="shadow btn btn-primary mx-1" onclick="sendAjax()"><i class="fas fa-save"></i> Enviar </button>*@
                                        <button id="btnEnviar" type="submit" class="btn btn-success form-control mb-4">Iniciar sesión</button>
                                    </div>
                                </div>
                                @*<p class="mb-0 text-muted text-right">
                                <a href="~/Usuario/RecuperarContrasenia/" class="f-w-400">Olvidaste tu contraseña?</a>
                                </p>*@
                            </form>
                        </div>
                    </div>
                </div>
                @*<div class="card-body">
                @using (Html.BeginForm("IniciarSesion", "Loggin", FormMethod.Post, new { id = "Form1" }))
                {
                <div class="row ">
                <div class="col-12 ">
                <button type="submit" class="btn btn-primary float-right" style="font-family: 'Google Sans',Roboto,Arial,sans-serif;">WebApi</button>
                </div>
                </div>
                }
                </div>*@
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    <script>
        function sendAjax() {
            event.preventDefault();
            //swal('Error', 'Falló al enviar la solicitud: ' , 'error');
            //if (!event.result){
            //    console.log("if");
            //    return false;
            //}
            //else{
            //    console.log("else");
            //    event.preventDefault();
            //}

            $.ajax({
                type: 'POST',
                //url: '/Loggin/IniciarSesion/',
                url: '@Url.Action("Login", "Home", null)',
                data: $("form").serialize(),
                //cache: false,
                //contentType: false,
                //processData: false,
                dataType: 'json',
                beforeSend: function () {
                    showProgress();
                    $('#btnEnviar').prop('disabled', true);
                },
                success: function (data) {
                    console.log("1");
                    console.log(data); 
                    if (code => 200 && code < 299) { 
                         
                        window.location.replace("/Usuario/Index/"); 
                    }
                    else {
                        Swal.fire({ icon: 'error', title: 'Oops...', text: data.responseJSON.message }); 
                        $('#btnEnviar').prop('disabled', false);
                    } 
                    hideProgress();
                },
                error: function (data) {
                    console.log(data);
                    console.log();
                    var code = data.responseJSON.code;

                    if (code => 400 && code < 499) {
                        Swal.fire('AVISO', data.responseJSON.message, 'question');
                    }
                    else if (code => 500 && code < 599) {
                        Swal.fire({ icon: 'error', title: 'Oops...', text: data.responseJSON.message });
                    }


                    $('#btnEnviar').prop('disabled', false);

                    hideProgress();
                }
            });

        };
    </script>
}


